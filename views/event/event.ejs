<!doctype html>
<html lang="en">

<head>
    <%- include('../partials/head', {title: title}) %>
</head>

<body class="bg-gray">
    <%- include('../partials/header', {title: title}) %>
    <% if(event !== null && participants !== null){%>
    <div class="content container">
                <div class="top">
                    <div class="left">
                        <label for="ename">Event Name:</label>
                        <p id="ename"><%= event.eventName %></p>
                    </div>
                    <label for="ename">Event Name:</label>
                    <input type="text" id="ename" name="eventName" value=<%= event.eventName %> required>
                    <br>
                    <label for="man">Event Manager:</label>
                    <p id="man">Manager</p>
                    <br>
                    <label for="cap">Capacity:</label>
                    <input type="text" id="cap" name="capacity" value=<%= event.capacity %> required>
                    <br>
                    <label for="psize">Max Party Size:</label>
                    <input type="text" id="psize" name="maxPartySize" value=<%= event.maxPartySize %> required>
                    <br>
                    <label for="ptype">Participation Type:</label>
                    <select id="ptype" name="privateEvent" form="eventform">
                        <option value="false" <% if(event.privateEvent == false){ %> <%= "selected" %> <% } %>>Public
                        </option>
                        <option value="true" <% if(event.privateEvent == true){ %> <%= "selected" %> <% } %>>Private
                        </option>
                    </select>
                    <br>
                    <label for="desc">Description:</label>
                    <input type="text" id="desc" name="eventDesc" value="<%= event.eventDesc %>">
                </div>
                <div class="right">
                    <label for="stime">Start Time:</label>
                    <input type="time" id="stime" name="startTime" value=<%= utils.getTime(event.startTime) %> required>
                    <label for="sdate">Start Date:</label>
                    <input type="date" id="sdate" name="startDate" value=<%= utils.getDate(event.startTime) %> required>
                    <br>
                    <label for="etime">End Time:</label>
                    <input type="time" id="etime" name="endTime" value=<%= utils.getTime(event.endTime) %> required>
                    <label for="edate">End Date:</label>
                    <input type="date" id="edate" name="endDate" value=<%= utils.getDate(event.endTime) %> required>
                    <br>
                    <label for="sratio">Staff Ratio:</label>
                    <input type="text" id="sratio" name="staffRatio" value=<%= event.staffRatio %> required>
                    <br>
                    <label for="notes">Notes:</label>
                    <input type="text" id="notes" name="eventNotes" value="<%= event.eventNotes %>">
                    <br>
                    <div id="newfields" form="eventform">
                        <% if(event.eventMetadata != null) { %>
                        <% var md = JSON.parse(event.eventMetadata); var keys = Object.keys(md); var vals = Object.values(md); %>
                        <% for(i=0; i < keys.length; i++){ %>
                        <div class="fieldwrapper<%= i %>">
                            <label for="field<%= -1-i %>">Field:</label>
                            <input type="text" id="field<%= -1-i %>" name="field<%= -1-i %>" class="fieldname"
                                form="eventform" value="<%= keys[i] %>">
                            <select class="fieldtype" name="type<%= -1-i %>" form="eventform">
                                <option value="checkbox" <% if(vals[i] == "checkbox"){ %> <%= "selected" %> <% } %>>
                                    Checked</option>
                                <option value="textbox" <% if(vals[i] == "textbox"){ %> <%= "selected" %> <% } %>>Text
                                </option>
                                <option value="textarea" <% if(vals[i] == "textarea"){ %> <%= "selected" %> <% } %>>
                                    Paragraph</option>
                            </select>
                            <input type="button" onclick="remove(<%= i %>)" class="remove" value="X">
                        </div>
                        <script>
                            var remove = function (i) {
                                $(`.fieldwrapper${i}`).remove()
                            };
                        </script>
                        <br>
                        <% } %>
                        <% } %>
                    </div>
                </div>
                <div class="container content">
                    <table class="table">
                        <thead>
                          <tr>
                            <th scope="col"> History </th>
                            <th scope="col"> First Name </th>
                            <th scope="col"> Last Name </th>
                            <th scope="col"> Phone # </th>
                            <th scope="col"> Email </th>
                            <th scope="col"> Emergency Name </th>
                            <th scope="col"> Emergency Phone # </th>
                            <th scope="col"> Zipcode </th>
                            <th scope="col"> Is Adult </th>
                            <th scope="col"> Is CPR Certified </th>
                            <th scope="col"> Can Swim </th>
                            <th scope="col"> Has Boat Experience </th>
                            <th scope="col"> Boathouse Discovery </th>
                            <th scope="col"> Event Discovery </th>
                            <th scope="col"> Registration Comments </th>
                            <th scope="col"> Registration Status </th>
                            <th scope="col"> Check In Status </th>
                            <th scope="col"> Is Volunteer </th>
                            <th scope="col"> Registration Time </th>
                            <th scope="col"> User Comments </th>
                          </tr>
                        </thead>
                        <tbody>
                          <% for(i = 0; i < participants.length; i++){ %>
                            <tr>
                              <td>
                                <a class="btn btn-primary" href="/participant/<%= participants[i].participantID %>" role="button">
                                  View
                                </a>
                              </td>
                              <td> <%= participants[i].firstName %> </td>
                              <td> <%= participants[i].lastName %> </td>
                              <td> <%= participants[i].phone %> </td>
                              <td> <%= participants[i].email %> </td>
                              <td> <%= participants[i].emergencyName %> </td>
                              <td> <%= participants[i].emergencyPhone %> </td>
                              <td> <%= participants[i].zip %> </td>
                              <td> <%= participants[i].isAdult %> </td>
                              <td> <%= participants[i].hasCPRCert %> </td>
                              <td> <%= participants[i].canSwim %> </td>
                              <td> <%= participants[i].boatExperience %> </td>
                              <td> <%= participants[i].boathouseDisc %> </td>
                              <td> <%= participants[i].eventDisc %> </td>
                              <td> <%= participants[i].regComments %> </td>
                              <td> <%= participants[i].regStatus %> </td>
                              <td> <%= participants[i].checkinStatus %> </td>
                              <td> <%= participants[i].volunteer %> </td>
                              <td> <%= participants[i].regTime %> </td>
                              <td>
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#comments<%= participants[i].participantID %>">
                                  Comments
                                </button>
                              </td>
                            </tr>
                          <% } %>
                
                        </tbody>
                      </table>
                
                      <% for(i = 0; i < participants.length; i++){ %>
                        <div class="modal" id="comments<%= participants[i].participantID %>">
                          <div class="modal-dialog">
                            <div class="modal-content">
                        
                              <!-- Modal Header -->
                              <div class="modal-header">
                                <h4 class="modal-title">Comments for <%= participants[i].firstName + " " + participants[i].lastName %></h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                              </div>
                        
                              <!-- Modal body -->
                              <div class="modal-body">
                                <form action="/participant/comment/<%= event.eventID %>/<%= participants[i].participantID %>" method="POST" id="form<%= participants[i].participantID %>">
                                  <textarea class="form-control" name="comment"><%= participants[i].userComments %></textarea>
                                </form>
                              </div>
                        
                              <!-- Modal footer -->
                              <div class="modal-footer">
                                <button type="submit" class="btn btn-danger" form="form<%= participants[i].participantID %>">Save</button>
                              </div>
                
                            </div>
                          </div>
                        </div>
                      <% } %> 
                
                      <a href="/participants/checkin/<%= event.eventID %>">Check In Participants</a>                
                </div>
            </form>
        </fieldset>
    </div>
    <% } %>
    <footer>
        <%- include('../partials/footer') %>
    </footer>
    <%- include('../partials/scripts') %>
    <script src="/scripts/addFields.js" metadata="<%= event.eventMetadata %>"></script>
</body>

</html>